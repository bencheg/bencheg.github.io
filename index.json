[{"categories":null,"contents":"\rВ свое время регулярно покупались лицензии для КриптоПро CSP и как не старались вести учет лицензий, все равно накосячили. Ноутбуки меняются, не всегда успевали вносить во внутреннюю wiki активируемые лицензии.\nХорошо (нет) что КриптоПро хранит серийный номер в открытом виде в реестре - раздел ProductID. Это позволит нам удаленно собрать информацию со всех компьютеров в сети.\nДля КриптоПро CSP 4.x: HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\S-1-5-18\\Products\\7AB5E7046046FB044ACD63458B5F481C\\InstallProperties\nДля КриптоПро CSP 5.x: HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\S-1-5-18\\Products\\08F19F05793DC7340B8C2621D83E5BE5\\InstallProperties\n","permalink":"https://marand.ru/cryptopro_csp_serial/","tags":["cryptopro","howto"],"title":"Как найти ключ для CryptoPro"},{"categories":null,"contents":"Chromium-GOST - опенсорсный проект на базе движка chromium с поддержкой ГОСТ криптографии. Сейчас для взаимодействия с государственными органами вариантов особо нет - или Яндекс.Браузер или Chromium-GOST.\nУ меня для каждой организации своя виртуалка на достаточно старой Windows - Server 2012R2. Последняя версия Chromium-GOST которая работает со старыми windows - chromium-gost-109.0.5414.141\nПо умолчанию инсталлятор ставит браузер только для текущего пользователя. Но есть способ установить браузер для всех пользователей системы: chromium-gost-109.0.5414.141-windows-amd64-installer.exe --system-level --install\nАвтоматически ставим нужные расширения Также, можно указать браузеру что бы он установил нужные расширения при запуске. Например, я ставлю сразу КриптоПро ЭЦП Browser-plugin. Для этого нужно добавить следующую ветку в реестр: REG add HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Chromium\\ExtensionInstallForcelist /v 1 /t REG_SZ /d \u0026#34;iifchhfnnmpdbibifmljnfjhpififfog;https://clients2.google.com/service/update2/crx\u0026#34; /f Здесь iifchhfnnmpdbibifmljnfjhpififfog это идентификатор расширения в магазине Google Chrome.\nНа картинке ниже, на примере расширения uBlock Origin - идентификатор в URL:\nТаким образом можно добавить любое расширение из магазина расширений.\n","permalink":"https://marand.ru/install_chromium-gost/","tags":["howto"],"title":"Устанавливаем Chromium-GOST для всех пользователей "},{"categories":null,"contents":"Настраивал сервер на одном компьютере, а понадобился доступ с другого. Настроить проще простого:\nПодключаемся к серверу по ssh Смотрим содержимое файла cat /opt/outline/access.txt Подставляем полученное содержимое в шаблон: {\u0026#34;apiUrl\u0026#34;:\u0026#34;сюда_ссылку\u0026#34;,\u0026#34;certSha256\u0026#34;:\u0026#34;сюда_хеш\u0026#34;} Вставляем полученную строку в Outline Manager ","permalink":"https://marand.ru/connect_outline/","tags":["ouline","howto"],"title":"Подключаемся к существующему серверу Outline"},{"categories":null,"contents":"Небольшая памятка о том, как подключиться к консоли Cisco на MacOS. Разумеется, это не только для Cisco, так можно подключиться к любой консоли да и вообще к любому последовательному порту.\nОткрываем терминал Ищем нужный usb: macbook:user$ cd /dev macbook:user$ ls -ltr /dev/*usb* crw-rw-rw- 1 root wheel 9, 66 Apr 1 16:46 tty.usbmodem1a21 Подключаемся к порту, подставляя в команду имя устройства и скорость (9600): macbook:user$ screen /dev/tty.usbmodem1a21 9600 ","permalink":"https://marand.ru/cisco_configuration_on_macos/","tags":["cisco","macos","howto"],"title":"Подключаемся к консоли сетевого оборудования на MacOS"},{"categories":null,"contents":"Для 32-х битных систем\nregsvr32 \u0026#34;c:\\program files (x86)\\1cv8\\\u0026lt;версия_1С\u0026gt;\\bin\\comcntr.dll\u0026#34; Для 64-х битных систем\nC:\\Windows\\SysWOW64\\regsvr32 \u0026#34;C:\\Program Files\\1cv8\\\u0026lt;версия_1С\u0026gt;\\bin\\comcntr.dll\u0026#34; Удаление Просто добавляем ключ /u. Например: C:\\Windows\\SysWOW64\\regsvr32 /u \u0026#34;C:\\Program Files\\1cv8\\\u0026lt;версия_1С\u0026gt;\\bin\\comcntr.dll\u0026#34;\n","permalink":"https://marand.ru/registraciya-v83-comconnector/","tags":["1C"],"title":"Регистрация COM компоненты 1С Предприятия comcntr.dll (V83.ComConnector)"},{"categories":null,"contents":"Внезапно перестал монтироваться внешний жесткий диск wd my passport отформатированный в exfat. Проверил под windows — все ок, а macos не видит и всё.\nРешение: sudo pkill -f fsck\nТакое бывает из-за некорректного отключения диска, fsck (file system consistency check) пытается восстановить файловую систему, но так как exfat не поддерживает журналирование, получается проблема :(\n","permalink":"https://marand.ru/macos-oshibka-podklyucheniya-exfat-diska/","tags":["macos"],"title":"macOS: ошибка подключения exfat диска"},{"categories":null,"contents":"Размер системной базы msdb стал больше 11 гб, настало время ее почистить.\nДля начала, посмотрим какая таблица сколько места занимает:\nUSE MSDB select t.name as TableName,Min(t.create_date) as CreateDate,ds.name as FileGroupName, SUM(u.total_pages)*8/1024 as SizeMB from sys.tables as t inner join sys.partitions as p on t.object_id=p.object_id inner join sys.allocation_units as u on p.partition_id=u.container_id inner join sys.data_spaces as ds on u.data_space_id=ds.data_space_id group by t.name, ds.name order by sizemb desc В моем случае это была таблица sysmaintplan_logdetail. Около 10 гб.\nЧистим: USE MSDB ALTER TABLE [dbo].[sysmaintplan_log] DROP CONSTRAINT [FK_sysmaintplan_log_subplan_id]; ALTER TABLE [dbo].[sysmaintplan_logdetail] DROP CONSTRAINT [FK_sysmaintplan_log_detail_task_id]; truncate table msdb.dbo.sysmaintplan_logdetail; truncate table msdb.dbo.sysmaintplan_log; ALTER TABLE [dbo].[sysmaintplan_log] WITH CHECK ADD CONSTRAINT [FK_sysmaintplan_log_subplan_id] FOREIGN KEY([subplan_id]) REFERENCES [dbo].[sysmaintplan_subplans] ([subplan_id]); ALTER TABLE [dbo].[sysmaintplan_logdetail] WITH CHECK ADD CONSTRAINT [FK_sysmaintplan_log_detail_task_id] FOREIGN KEY([task_detail_id]) REFERENCES [dbo].[sysmaintplan_log] ([task_detail_id]) ON DELETE CASCADE;\nПосле этого обязательно сжимаем базу: DBCC SHRINKFILE (MSDBData, 512)\nПроверяем результат: SELECT name, size = size * 8. / 1024, space_used = FILEPROPERTY(name, \u0026#39;SpaceUsed\u0026#39;) * 8. / 1024 FROM sys.database_files\nИ добавить еще очистку логов джобов и бекапов: DECLARE @DateBefore DATETIME SET @DateBefore = DATEADD(DAY, -7, GETDATE()) EXEC msdb.dbo.sp_purge_jobhistory @oldest_date = @DateBefore DECLARE @DateBefore DATETIME SET @DateBefore = DATEADD(DAY, -60, GETDATE()) EXEC msdb.dbo.sp_delete_backuphistory @oldest_date = @DateBefore\n","permalink":"https://marand.ru/umenshaem-razmer-msdb/","tags":["mssql"],"title":"Уменьшаем размер MSDB"},{"categories":null,"contents":"В общей сложности, по Норвегии я проехал больше 20 тысяч километров. С севера на юг, с юга на север. При подготовке к трем моим поездкам в страну фьордов и водопадов собрал небольшую коллекцию ссылок. Уверен, они будут полезны тем, кто собирается посетить эту красивейшую, но дорогую страну.\nЯ разбил ссылки по категориям, пост периодически обновляю.\nКарты FINN kart\n1881 - потрясающая детализация спутниковых снимков\nТопо карты Норвегии с пешими маршрутами\nЕще карты\nЕще одни\nПаромы, транспорт Torghatten Nord AS - маршруты, расписание и цены на некоторые паромы\nПаромы - еще паромы\nПаромы - еще одна паромная контора\nИ еще паромы\nПаром Анденес - Сенья (Gryllefjord)\nИнформация о платных дорогах\nОтчеты, информация о маршрутах Маршруты для хайкинга - очень много маршрутов. Правда, только на норвежском.\nЕще маршруты, с описанием, с треками.\nБлог о Лофотенских островах - ведет потрясающий фотограф Cody Duncan\nVisitNorway.com - русскоязычный сайт, на котором собрано куча полезной информации о Норвегии\nДля любителей гор - информация почти обо всех возвышенностях Норвегии с маршрутами, фотографиями\nЕще горы - здесь, правда, не только по Норвегии\nVinmonopolet адреса магазинов vinmonopolet, где можно купить алкоголь\nСафари на паффинов - очень прикольные птички, у нас больше известны как морские попугаи\nКитовое сафари - дорого, но посмотреть на китов того стоит\nТреки по Лофотенским островам\nПрогулки по Норвегии\nАвтопутешествие в Норвегию на ОКЕ\nНорвегия. Полезная информация для тех, кто за рулем\nНаше скандинавское путешествие\nПогода, полярное сияние Погода и прогноз интенсивности полярного сияния\nseNorge\nYR.NO - очень точные прогнозы\nПрогноз полярного сияния от Геофизического института на Аляске\nОнлайн камера, показывающая текущее состояние неба\nЦентр предсказания космической погоды, в особенности эта картинка\nAurora Sky Station находится в Швеции, но там есть прогноз и для Норвегии\nСофт для iOS - прогноз на телефоне\nКемпинги, жилье Каталог кемпингов\nЕще один каталог\nКемпинг на Лофотенах\n","permalink":"https://marand.ru/norway-links/","tags":["travel","norway"],"title":"🇳🇴 Норвегия. Полезные ссылки"},{"categories":null,"contents":"Microsoft со своим магазином приложений только усложняет жизнь простым людям, которым не нужна учетка для пользования своим компьютером. Например, что бы скачать плагин поддержки HEIF/HEIC нужно регистрироваться/логинится с учетной записью microsoft.\nНо есть способ проще.\nОткрываем скрипт, нажимаем кнопку RAW, затем Файл - Сохранить как (или ctrl + s). Запускаем, вставляем ссылку на приложение в Microsoft Store и начнется скачивание приложения.\nДа, вид ссылки должен быть такой: https://www.microsoft.com/store/apps/9pmmsr1cgpwg https://www.microsoft.com/en-us/p/heif-image-extensions/9pmmsr1cgpwg https://www.microsoft.com/ru-ru/p/heif-image-extensions/9pmmsr1cgpwg\nСкрипт скачивает все возможные варианты поставки:\nВыбираем нужную платформу и устанавливаем. Если не знаете какая, пробуйте x64, с расширением appx.\nЕсли Windows вдруг спрашивает чем открыть .appx, то проще будет установить через PowerShell:\nAdd-AppxPackage -Path \u0026#34;C:\\Path\\to\\File.Appx\u0026#34; ","permalink":"https://marand.ru/install-from-microsoft-store-no-reg/","tags":["windows"],"title":"Как установить приложение из Microsoft Store без регистрации"},{"categories":null,"contents":"\nWireguard отличная альтернатива openvpn. А по части настройки так вообще на три головы впереди. Я использую wg для организации туннеля в домашнюю сеть.\nСтавим wireguard Идем на github и копируем ссылку на deb пакет в зависимости от прошивки и модели роутера. В моем случае это e50-v2-v1.0.20211208-v1.0.20210914.deb user@ubnt:~$ curl -OL link-to-deb user@ubnt:~$ sudo dpkg -i e50-v2-v1.0.20211208-v1.0.20210914.deb\nГенерируем ключи: wg genkey | tee /config/auth/wg.key | wg pubkey \u0026gt; wg.public Приватный ключ будет лежать в /config/auth/wg.key, публичный в текущей директории. Потом публичный ключ можно посмотреть командой sudo wg show\nНастраиваем интерфейс на роутере: configure set interfaces wireguard wg0 address 192.168.5.1/24 set interfaces wireguard wg0 listen-port 51820 set interfaces wireguard wg0 route-allowed-ips true set interfaces wireguard wg0 private-key /config/auth/wg.key commit save Добавляем peer В приложении Wireguard что на ios, что в macos, что в windows при добавлении нового туннеля ключи генерируются автоматом, нужно только скопировать:\nПрописываем публичный ключ роутера, его ip и порт. Обязательно указываем ip адрес устройства, на котором настраиваем - он должен быть уникальным. Например, на телефоне 192.168.5.2, на макбуке 192.168.5.3 и т.д.\nПример конфига для macos и windows: [Interface] PrivateKey = приватный ключ пира Address = 192.168.5.3/32 [Peer] PublicKey = публичный ключ роутера AllowedIPs = 192.168.5.0/24, 192.168.1.0/24 // указываем сети, в которые нужен доступ Endpoint = ip:51820 //внешний адрес роутера PersistentKeepalive = 15\nДобавляем peer в конфиг роутера configure set interfaces wireguard wg0 peer публичный_ключ_пира1 allowed-ips 192.168.5.2/32 set interfaces wireguard wg0 peer публичный_ключ_пира2 allowed-ips 192.168.5.3/32 commit save Настраиваем файрвол configure set firewall name WAN_LOCAL rule 20 action accept set firewall name WAN_LOCAL rule 20 protocol udp set firewall name WAN_LOCAL rule 20 description \u0026#39;WireGuard\u0026#39; set firewall name WAN_LOCAL rule 20 destination port 51820 commit save Все, vpn настроен, доступ в домашнюю сеть есть как с телефона, так и с ноутбука.\n","permalink":"https://marand.ru/install-wireguard-edgerouter/","tags":["edgerouter","wireguard"],"title":"Edgerouter: Установка Wireguard"},{"categories":null,"contents":"\nAdguard Home - бесплатное ПО с открытым исходным кодом для блокировки рекламы, трекинга, фишинга и прочей нечисти на всех устройствах в сети: планшеты, телефоны, приставки, телевизоры и прочие роботы-пылесосы. Так что китайцы не узнают от вашего робота-пылесоса сколько у вас комнат.\nЧто нужно. Что-то, куда можно установить AdGuard, у меня это Raspberry Pi 4. Но это может быть и роутер, и сетевой накопитель Synology/QNAP. Да вообще всё что угодно, на самом деле. Ну, кроме робота-пылесоса.\nУстановка Установка очень простая, как инструкция из Икеи. Заходим по ssh и вводим: wget \u0026#39;https://static.adguard.com/adguardhome/release/AdGuardHome_linux_armv6.tar.gz\u0026#39; tar -f AdGuardHome_linux_armv6.tar.gz -x -v Правда, стоит выбрать пакет под свою архитектуру.\nЗатем: cd ./AdGuardHome/ sudo ./AdGuardHome -s install\nВсё, установили. Переходим по http://192.168..:3000/ и за 5 простых шагов настраиваем. 192.168.. тут - ip устройства, куда установили AdGuard.\nЧто касается фильтров и настройки DNS Я выбрал следующие Upstream DNS-серверы: tls://security.cloudflare-dns.com https://security.cloudflare-dns.com/dns-query И выбрал пункт \u0026ldquo;Параллельные DNS запросы\u0026rdquo;, для ускорения обработки запросов. Что бы DNS запросы шифровались, нужно перейти в \u0026ldquo;Настройки\u0026rdquo; - \u0026ldquo;Настройки шифрования\u0026rdquo; и поставить галку \u0026ldquo;Включить шифрование\u0026rdquo;.\nПерепробовав несколько фильтров остановился на этих:\nhttps://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt https://adaway.org/hosts.txt https://v.firebog.net/hosts/Easyprivacy.txt https://raw.githubusercontent.com/crazy-max/WindowsSpyBlocker/master/data/hosts/spy.txt https://raw.githubusercontent.com/AdguardTeam/FiltersRegistry/master/filters/filter_1_Russian/filter.txt https://raw.githubusercontent.com/AdguardTeam/FiltersRegistry/master/filters/filter_11_Mobile/filter.txt Устанавливаем сертификат для корректной работы шифрования Ставить будем бесплатный Let`s Encrypt. Для подтверждения домена не хочется открывать веб-интерфейс наружу и заморачиваться с правилами файрвола, поэтому воспользуюсь DNS подтверждением от CloudFlare.\nДелегируем домен на CloudFlare. Меняем ns на те, что предлагает CF и ждем обновления зоны.\nУстанавливаем необходимые пакеты: sudo apt install certbot python3-certbot-dns-cloudflare Создаем файл с авторизационными данными: mkdir /secrets/ touch /secrets/cloudflare.ini nano /secrets/cloudflare.ini Вставляем в файл token для доступа к CF. Нам пойдет токен из шаблона \u0026ldquo;Edit zone DNS\u0026rdquo;\ndns_cloudflare_api_token = token Меняем права: sudo chmod 0700 /secrets/ sudo chmod 0400 /secrets/cloudflare.ini Отправляем запрос на сертификат: sudo certbot certonly --dns-cloudflare --dns-cloudflare-credentials /home/pi/secrets/cloudflare.ini -d example.com,*.example.com --preferred-challenges dns-01 Не забудьте поменять домен. Сертификаты сохранятся в /etc/letsencrypt/live/example.com/\nОсталось добавить их в AdGuard. \u0026ldquo;Настройки\u0026rdquo; - \u0026ldquo;Настройки шифрования\u0026rdquo;. И вставляем наши сертификаты.\nВот и всё.\n","permalink":"https://marand.ru/adguard-home/","tags":["adguard"],"title":"AdGuard Home - блокируем рекламу во всем доме."},{"categories":null,"contents":"Краткая шпаргалка по сбросу конфигурации свитчей Cisco на ios. Имеется ввиду hard reset - сброс к заводским настройкам.\nЕсли логин/пароль известны, логинимся и вводим:\ncisco_bb# write erase Erasing the nvram filesystem will remove all files! Continue? [confirm]y[OK] Erase of nvram: complete cisco_bb# cisco_bb# reload Если доступа к конфигу нет, то включаем свитч с зажатой кнопкой mode. Дальше в консоли появляется что-то такое, после чего отпускаем кнопку: The system has been interrupted prior to initializing the flash filesystem. The following commands will initialize the flash filesystem, and finish loading the operating system software: flash_init load_helper boot\nВводим: flash_init\nУдаляем файлы конфигурации:\nswitch: del flash:config.text switch: del flash:vlan.dat И командуем загрузку: switch: boot\n","permalink":"https://marand.ru/reset-cisco-switch/","tags":["cisco"],"title":"Сброс конфигурации свитчей Cisco"},{"categories":null,"contents":"Столкнулся с забавной проблемой в Chrome - открываешь astral.ru (Астрал Отчет 5.0) и получаешь черный экран.\nВыход и вход или перезапуск браузера иногда помогает, но лишь в четверти случаев.\nРешение: отключить аппаратное ускорение. В адресную строку вводим:\nchrome://settings/system\nИли\nНастройки - Система.\nИ отключаем аппаратное ускорение\n","permalink":"https://marand.ru/chrome-black-screen/","tags":["chrome"],"title":"Chrome - черный экран при открытии сайта Астрал Отчет 5.0"},{"categories":null,"contents":"Для того что бы mssql мог писать в сетевую папку, его нужно запускать под отдельной учеткой. Встроенные NT Service\\ не могут писать в сетевые папки. Я создаю доменные учетки, но если Active Directory не поднят, то подойдут и обычные локальные.\nОткрываем редактор локальных политик безопасности: Пуск - Выполнить - secpol.msc\nПараметры безопасности (Security Settings) - Локальные политики (Local Policies) - Назначение прав пользователя (User Rights Assignment).\nДля корректной работы MS SQL, нужно добавить пользователю следующие права:\nLog on as a batch job (Входить в рамках выполнения пакета команд)\nReplace a process-level token (Заменять маркер безопасности процесса)\nBypass traverse checking (Проходить сквозь каталоги, на которые этой учетной записи не предоставлены разрешения)\nAdjust memory quotas for a process (Настраивать квоты на использование памяти для процесса)\n","permalink":"https://marand.ru/mssql-active-directory-rights/","tags":["mssql"],"title":"Необходимые права для учетной записи MSSQL"},{"categories":null,"contents":"\nНаконец-то нашел способ как отдельно поставить Word и Excel из пакета Microsoft Office! Не знаю зачем тратить место на программы, которые никогда не использую.\nВ общем, заходим и скачиваем отдельные программы.\n","permalink":"https://marand.ru/microsoft-office-macos-tolko-word-i-excel/","tags":["ms","macos"],"title":"Microsoft Office для macos: установка только Word и Excel"},{"categories":null,"contents":"На самом деле, так можно остановить любую зависшую службу. На примере 1С:Предприятия:\nВыясняем pid процесса:\nsc queryex \u0026#34;1C:Enterprise 8.3 Server Agent (x86-64)\u0026#34; Затем:\ntaskkill /f /pid [PID] [PID] - ID процесса из команды выше.\nЗапускаем службу.\n","permalink":"https://marand.ru/1c-service-stopping/","tags":["windows","1C"],"title":"Служба Агент сервера 1С:Предприятия 8.3 (x86-64) зависла в состоянии «остановка»"},{"categories":null,"contents":"Оставлять 22 порт с авторизацией по паролю, ну\u0026hellip; такое. Тем более на роутере. Значит надо добавить авторизацию по ключу!\nЕсли ключа у вас нет, то:\ncd ~/.ssh ssh-keygen -t rsa -C \u0026#34;email@example.com\u0026#34; Далее надо скопировать публичный ключ на роутер, подставив ip своего роутера: scp ~/.ssh/id_rsa.pub 192.168.1.1:/tmp\nИ импортируем ключ для пользовтеля : configure loadkey \u0026lt;user\u0026gt;/tmp/id_rsa.pub commit save exit Вы же заменили дефолтного ubnt, верно?\n","permalink":"https://marand.ru/edgerouter-ssh-key/","tags":["edgerouter"],"title":"Edgerouter: авторизация по ssh ключу"},{"categories":null,"contents":"По одному из проектов получил на поддержку несколько сотен айпадов, которые разбросаны по стране. Часть из них предыдущий подрядчик зачем-то настроил ручками - купил домен и зарегистрировал кучу apple id.\nКомпания международная, есть своя MDM team, которая с помощью GroundControl + VMWare AirWatch управляет девайсами централизовано. Надо только установить. Почему это не сделано изначально? В ответ услышал что-то вроде \u0026ldquo;Сложно\u0026rdquo; и \u0026ldquo;Не разобрались\u0026rdquo;. Пришлось разбираться.\nВ общем, самый неприятный в настройке момент - выход новой версии ios. Когда апдейт становится доступным для всех известно, но когда его протестируют в команде MDM и опубликуют для обновления корпоративных устройств - тайна. Это может быть день, неделя, месяц. Так как установка AirWatch в обязательном порядке обновляет версию ios, бывали ситуации когда при подключении очередного планшета GC хочет скачать новую прошивку, которая весит 6,5 ГБ. На мобильном интернете это очень долго.\nНо выход есть!\nСкачиваем прошивку после выхода (например, на ipsw.me или Enterprise iOS) и не меняя имени файла, кладем в папку с кешем:\nMAC: ~/Library/Application Support/GroundControl/Content Downloads/\nWindows: %LOCALAPPDATA%\\GroundControl\\Content Downloads\\\nТеперь я закидываю прошивку сразу после выхода и не жду \u0026ldquo;сюрпризов\u0026rdquo;.\n","permalink":"https://marand.ru/ground-control-assets-folder/","tags":null,"title":"Ground Control: папка с кешем и новые версии ios"}]